//================================================================================================//
//                                                                                                //
// PROJET       : DongleWifi GoodRace                                                             //
// MODULE       : Board                                                                           //
// DESCRIPTION  :                                                                                 //
// CREATION     : 27/01/2020                                                                      //
// HISTORIQUE   :                                                                                 //
//                                                                                                //
//================================================================================================//

//================================================================================================//
//                                        FICHIERS INCLUS                                         //
//================================================================================================//
#include "./screen.h"

//================================================================================================//
//                                            DEFINES                                             //
//================================================================================================//

//================================================================================================//
//                                          ENUMERATIONS                                          //
//================================================================================================//

//================================================================================================//
//                                      STRUCTURES ET UNIONS                                      //
//================================================================================================//

////////////////////////////////////////////////////////////////////////////////////////////////////
//                                 VARIABLES PRIVEES ET PARTAGEES                                 //
////////////////////////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------------------------//
//---                                         Privees                                          ---//
//------------------------------------------------------------------------------------------------//

//------------------------------------------------------------------------------------------------//
//---                                        Partagees                                         ---//
//------------------------------------------------------------------------------------------------//

////////////////////////////////////////////////////////////////////////////////////////////////////
//                                 FONCTIONS PRIVEES ET PARTAGEES                                 //
////////////////////////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------------------------//
//---                                         Privees                                          ---//
//------------------------------------------------------------------------------------------------//
static e_SCREEN _e_screen = SCREEN_BOOTING;
static e_SCREEN _old_e_screen = SCREEN_MAX;
static unsigned long _ms = millis();
//------------------------------------------------------------------------------------------------//
//---                                        Partagees                                         ---//
//------------------------------------------------------------------------------------------------//

//--------------------------------------------------------------------------------------------------
// FONCTION    : KEYBOARD_Init
//
// DESCRIPTION : Initialisation de la carte : GPIO, Clocks, Interruptions...
//--------------------------------------------------------------------------------------------------
void SCREEN_TaskInit(void)
{
    DISPLAY_Init();
    _e_screen = SCREEN_BOOTING;
    _ms = millis();
}

void SCREEN_Change(e_SCREEN _s)
{
    _e_screen = _s;
}

void SCREEN_TaskRun(void)
{
    bool forceRefresh = false;
    if ((millis() - _ms) > 1000)
    {
        forceRefresh = true;
        if (_e_screen == SCREEN_BOOTING)
        {
            SCREEN_Change(SCREEN_HOME);
        }
    }
    if (_old_e_screen != _e_screen)
    {
        DISPLAY_FillScreen();
        forceRefresh = true;
        _old_e_screen = _e_screen;
    }

    if (forceRefresh == true)
    {
        switch (_e_screen)
        {
        case (SCREEN_BOOTING):
        {
            DISPLAY_Booting();
            break;
        }
        case (SCREEN_HOME):
        {
            DISPLAY_Voltage();
            break;
        }
        default:
        {
            break;
        }
        }

        _ms = millis();
    }
}